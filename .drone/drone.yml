---
name: release
kind: pipeline
type: docker

trigger:
  event:
    exclude:
      - push
      - pull_request
    include:
      - tag

steps:
  - name: install-dependencies
    image: node:lts-bookworm
    commands:
      - yarn install --frozen-lockfile

  - name: build
    image: node:lts-bookworm
    depends_on:
      - install-dependencies
    commands:
      - yarn build

  - name: publish
    image: node:lts-bookworm
    commands:
      - git fetch --tags
      - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > .npmrc
      - yarn run publish from-git --yes --no-verify-access
    environment:
      NPM_TOKEN:
        from_secret: NPM_TOKEN

---
kind: signature
hmac: ef07e20fe0b0fd5e5653ed310bf882bc40dff696ee18239f771d617a5c089cf4

...
